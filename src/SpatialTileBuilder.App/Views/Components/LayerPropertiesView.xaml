<UserControl x:Class="SpatialTileBuilder.App.Views.Components.LayerPropertiesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:converters="clr-namespace:SpatialTileBuilder.App.Converters"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="300">
    <UserControl.Resources>
        <converters:ColorToBrushConverter x:Key="ColorToBrushConverter"/>
    </UserControl.Resources>
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="10">
            <TextBlock Text="Layer Properties" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,10"/>
            
            <!-- Basic Properties -->
            <TextBox Text="{Binding LayerName, UpdateSourceTrigger=PropertyChanged}" 
                     materialDesign:HintAssist.Hint="Layer Name" Style="{StaticResource MaterialDesignFloatingHintTextBox}" Margin="0,0,0,10"/>
            
            <DockPanel Margin="0,5">
                <TextBlock Text="Opacity" VerticalAlignment="Center" Width="80"/>
                <Slider Value="{Binding Opacity}" Minimum="0" Maximum="1" TickFrequency="0.1" IsSnapToTickEnabled="True"/>
            </DockPanel>

            <CheckBox IsChecked="{Binding IsFillVisible}" Content="Fill Visible" Margin="0,5"/>
            
            <DockPanel Margin="0,5">
                <TextBlock Text="Fill Color" VerticalAlignment="Center" Width="80"/>
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PopupBox StaysOpen="True" PlacementMode="BottomAndAlignLeft">
                        <materialDesign:PopupBox.ToggleContent>
                            <Border Width="40" Height="25" CornerRadius="4" BorderBrush="{DynamicResource MaterialDesignDivider}" BorderThickness="1"
                                    Background="{Binding FillColor, Converter={StaticResource ColorToBrushConverter}}" Cursor="Hand" ToolTip="Pick Color"/>
                        </materialDesign:PopupBox.ToggleContent>
                        <materialDesign:ColorPicker Color="{Binding FillColor, Mode=TwoWay}" Width="250" Height="250" />
                    </materialDesign:PopupBox>
                    <TextBox Text="{Binding FillColor}" Width="100" Margin="10,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>
            </DockPanel>

            <DockPanel Margin="0,5">
                <TextBlock Text="Stroke Color" VerticalAlignment="Center" Width="80"/>
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PopupBox StaysOpen="True" PlacementMode="BottomAndAlignLeft">
                        <materialDesign:PopupBox.ToggleContent>
                            <Border Width="40" Height="25" CornerRadius="4" BorderBrush="{DynamicResource MaterialDesignDivider}" BorderThickness="1" 
                                    Background="{Binding StrokeColor, Converter={StaticResource ColorToBrushConverter}}" Cursor="Hand" ToolTip="Pick Color"/>
                        </materialDesign:PopupBox.ToggleContent>
                        <materialDesign:ColorPicker Color="{Binding StrokeColor, Mode=TwoWay}" Width="250" Height="250" />
                    </materialDesign:PopupBox>
                    <TextBox Text="{Binding StrokeColor}" Width="100" Margin="10,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>
            </DockPanel>

             <DockPanel Margin="0,5">
                <TextBlock Text="Stroke Width" VerticalAlignment="Center" Width="80"/>
                <TextBox Text="{Binding StrokeWidth}" Width="50"/>
            </DockPanel>

            <Separator Margin="0,15"/>

            <!-- Rule Based Styling -->
            <TextBlock Text="Rules" Style="{StaticResource MaterialDesignSubtitle1TextBlock}" Margin="0,0,0,5"/>
            
            <!-- Classification -->
            <Grid Margin="0,0,0,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBox x:Name="ClassifyColumnParams" materialDesign:HintAssist.Hint="Column Name" Margin="0,0,5,0"/>
                <Button Grid.Column="1" Content="Classify" 
                        Command="{Binding ClassifyCommand}" 
                        CommandParameter="{Binding ElementName=ClassifyColumnParams, Path=Text}"
                        Style="{StaticResource MaterialDesignOutlinedButton}"/>
            </Grid>

            <DataGrid ItemsSource="{Binding Rules}" AutoGenerateColumns="False" CanUserAddRows="False" Height="250"
                      materialDesign:DataGridAssist.CellPadding="4 2 2 2" materialDesign:DataGridAssist.ColumnHeaderPadding="4 2 2 2">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
                    <DataGridTextColumn Header="Filter" Binding="{Binding FilterValue}" Width="*"/>
                    <DataGridTextColumn Header="Color" Binding="{Binding FillColor}" Width="60"/>
                    <DataGridTemplateColumn Width="Auto">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="{materialDesign:PackIcon Kind=Close}" 
                                        Command="{Binding DataContext.RemoveRuleCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                        CommandParameter="{Binding}"
                                        Style="{StaticResource MaterialDesignIconButton}" Height="20" Width="20"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
             
            <Button Content="Add Rule" Command="{Binding AddRuleCommand}" Margin="0,5" Style="{StaticResource MaterialDesignFlatButton}"/>

        </StackPanel>
    </ScrollViewer>
</UserControl>
